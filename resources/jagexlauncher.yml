name: Jagex Launcher
game_slug: jagex-launcher
version: Installer
slug: jagex-launcher-installer
runner: wine

script:
  files:
    - installscript: https://raw.githubusercontent.com/nmlynch94/jagex-launcher-linux/main/resources/jagex-installer.py
    - pythonrequirements: https://raw.githubusercontent.com/nmlynch94/jagex-launcher-linux/main/resources/requirements.txt
    - runelite: https://github.com/runelite/launcher/releases/download/2.6.8/RuneLite.jar
    - runelite-launcher: https://raw.githubusercontent.com/TormStorm/jagex-launcher-linux/main/resources/runelite.sh
    - hdos: https://cdn.hdos.dev/launcher/latest/hdos-launcher.jar
    - hdos-launcher: https://raw.githubusercontent.com/TormStorm/jagex-launcher-linux/main/resources/hdos.sh
    - steamdeck-config: https://raw.githubusercontent.com/TormStorm/jagex-launcher-linux/main/resources/steamdeck-config.properties

  game:
    exe: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/JagexLauncher.exe
    prefix: $GAMEDIR
  wine:
    overrides:
      jscript.dll: native
    version: wine-ge-8-20-x86_64
  installer:
    - input_menu:
        description: 'Confirm you have read, understand, and accept the EULA here: https://www.jagex.com/en-GB/terms/eula'
        id: EULA
        options:
        - accept: "I accept"
        - deny: "I do not accept"
        preselect: deny
    - execute:
        command: |
            if [ "$INPUT_EULA" = "accept" ]; then
                echo "EULA accepted. Continuing with installation..."
            else
                echo "EULA must be accepted before continuing. Quitting installation..."
                exit 1
            fi
    - task:
        name: create_prefix
        prefix: "$GAMEDIR"
    - task:
        name: set_regedit
        type: REG_SZ
        path: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\RuneLite Launcher_is1
        key: InstallLocation
        prefix: $GAMEDIR
        value: C:\\Program Files (x86)\\Jagex Launcher\\Games\\RuneLite
    - task:
        name: set_regedit
        type: REG_SZ
        path: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Uninstall\HDOS Launcher_is1
        key: InstallLocation
        prefix: $GAMEDIR
        value: C:\\Program Files (x86)\\Jagex Launcher\\Games\\HDOS
    - execute:
        command: |
            set -x
            mkdir -p "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher"
            cd "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher"
            python -m venv env
            source env/bin/activate
            python -m pip install -r "$pythonrequirements"
            python "$installscript"
        description: Installing the jagex-launcher files
    - task:
        name: winekill
        prefix: $GAMEDIR
    - execute:
        command: mkdir -p "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/"
        description: Creating game directory
    - merge:
        src: runelite
        dst: "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite"
    - chmodx: runelite
    - merge:
        src: runelite-launcher
        dst: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite
    - chmodx: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite/runelite.sh
    - execute:
        command: ln -s "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite/runelite.sh" "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/RuneLite/RuneLite.exe"
    - merge:
        src: hdos
        dst: "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/HDOS"
    - chmodx: hdos
    - merge:
        src: hdos-launcher
        dst: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/HDOS
    - chmodx: $GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/HDOS/hdos.sh
    - execute:
        command: ln -s "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/HDOS/hdos.sh" "$GAMEDIR/drive_c/Program Files (x86)/Jagex Launcher/Games/HDOS/HDOS.exe"
    - merge:
        src: steamdeck-config
        dst: $GAMEDIR
